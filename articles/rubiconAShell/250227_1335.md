# 【基本編】a-Shell(mini) のPython でUIKit からView を呼び出す【rubicon-objc】


## はじめに

i(Pad)OS で、i(Pad)OS のアプリを制作できます。

a-Shell, Pythonista3,（pyto :初回実行時module 読み込みのエラーあり）で動かすことができます。


### a-Shell とは？

[a-Shell](https://holzschu.github.io/a-Shell_iOS/)


[About the book | A guide to a-Shell](https://bianshen00009.gitbook.io/a-guide-to-a-shell)

### rubicon-objc とは？


[【非推奨】Rubicon-ObjC の手動インストール・インポート](https://zenn.dev/pometa/articles/466cd4b39f9684)


## 概要

先に、処理の流れをざっくりと見てみます。

なお、今回の実装では以下の状態を目指します:
- View を閉じた後も、a-Shell を通常動作で使用するとこができる
- 呼び出したView は、自分自身のView を閉じることができる


### Python の実行から、view が閉じるまで

1. Application(a-Shell) のインスタンスから、`rootViewController` を取得
1. Main thread 上で、実装したViewController を`rootViewController` へ`present`
1. rubicon-objc の`event_loop` が走る
1. View が表示される
1. View が閉じる際に`event_loop` を停止
1. a-Shell に戻る


通常Xcode の開発は、`@UIApplicationMain`（Objective-C は、`main` 関数）から始まります。

今回は、a-Shell 側で「起動時の`AppDelegate` を済ませている」と見立て「a-Shell へ`UIViewController`（`UINavigationController`）を追加する」という方針でView を表示させます。



## コードの各部解説

コードは、記事『[【非推奨】Rubicon-ObjC の手動インストール・インポート](https://zenn.dev/pometa/articles/466cd4b39f9684)』の設定を前提としています。

pip 等でrubicon-objc を入れた場合には:

``` diff.py
- from pyrubicon.objc.〜 import 〜
+ from rubicon.objc.〜 import 〜

```

と、`pyrubicon` を`rubicon` に置き換えてください。


### 全体

rubicon-objc と、1つのファイルのみの構成です。


``` sampleCode.py
# hoge
```

以降、コアな要素から順に解説していきます。


### class: `App`


### デコレータ:`@onMainThread`

### event loop: `EventLoopPolicy`


### class: `RootNavigationController`


### その他

#### log 吐き

#### `NSStringFromClass`



## おわりに

a-Shell 自身とPython 実装のViewController 連携ができました。

繋ぎ込みの部分は多少hacky になってしまいましたが、全体の処理の流れがざっくりと掴んでもらえていたら嬉しいです。

今回は、1ファイルにコードを全て詰め込んでしまったので、次回そのコード群を分けてmodule 化していきます。






